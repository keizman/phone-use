  当前的MCP tools太多了，可能导致外部LLM无法正常选用tool，请你：

  1. 智能分层简化策略
  - 保留Omniparser全部专业功能 - 这是核心竞争力，不能简化
  - 合并基础重复工具 - 只合并功能相似的基础ADB操作
  - 按使用频率分组 - 高频工具保持独立，低频工具可以合并
  - 保持专业工具独立性 - 视觉识别、prompt工程等专业功能保持独立

  2. 分层工具架构设计
  【核心专业层】- 保持独立，突出专业性
  - omniparser_analyze_screen (视觉分析主工具)
  - omniparser_tap_element_by_uuid (精确交互主工具)
  - omniparser_execute_action_by_uuid (高级交互工具)
  - get_task_guidance (AI任务指导)

  【常用功能层】- 适度合并，保持便利性
  - phone_basic_interaction (基础tap/swipe/input，非视觉)
  - phone_app_management (应用启动/停止/列表)
  - phone_system_control (系统按键/设置/导航)

  【辅助工具层】- 合并同类，减少选择
  - phone_file_operations (文件传输/APK安装/截图)
  - phone_info_and_debug (设备信息/连接检查/调试)

  3. 增强Prompt设计原则
  - 功能优先级明确: 用★★★标记主要工具，★★次要工具，★辅助工具
  - 使用场景描述: 每个工具明确说明"什么时候用这个工具"
  - 工具选择指引: 提供"如果你想要...，请使用..."的明确指导
  - 避免功能重叠: 明确说明工具间的边界和选择标准

  4. 具体实施要求
  - Omniparser工具: 增强prompt突出视觉识别优势，明确与普通点击的区别
  - 基础工具合并: 将android_tap_coordinates等基础坐标工具合并到phone_basic_interaction
  - prompt工程独立: get_task_guidance等AI辅助工具保持独立，突出AI协作价值
  - 错误处理统一: 所有工具提供一致的错误处理和fallback机制

  5. LLM选择指导增强
  - 每个工具的docstring开头用大写粗体说明核心用途
  - 提供决策树：屏幕交互→优先Omniparser，文件操作→file_operations
  - 明确工具能力边界，避免LLM误选工具
  - 提供使用优先级：专业工具>通用工具>调试工具

  期望效果:
  - 工具数量从30+减少到12-15个
  - 保留所有Omniparser核心功能的专业性
  - 提供清晰的工具选择指导
  - 维持高级功能的便利性


-----



看来足够熟悉这个 MCP 工具， 现在我希望 1.airtest\lib\pure_uiautomator2_extractor.py 使用这个文件中的模块来增强 xml 解析能力， 你可以根据你对如何更好的自动化且实用的工具， 你可以复制代码过去，
最终目的是  
- 1.正常模式下使用 xml 方式定位元素最后点击， 执行用户任务， 
- 2.播放  状态下使用 omniparser 解析 现有模式. 确认播放状态使用以下手段

```
res = dumpsys media.audio_flinger | grep "Standby: no" | wc -l
res >= 1


Method 3: Checking Wake Locks for Audio (Advanced)
res = dumpsys power | grep -i wake | grep Audio
res >= 1
```

- 统一接口: 你可以设置一个 scheduler 来做这件事情. 外部 LLM 不应关注使用的是什么, 两种工具对外输出尽可能一致, 这样外界 LLM 感知不到差异能更好的工作, 
- 虽然外部不需要知道具体使用的哪个组件来获取下一步位置, 但是其依旧有选择, 能主动调用独立组件, 比如传入参数即可指定


---
了解一下 phone-use\phone_mcp\tools\ui*  以前是如何使用 ui 进行操作的，核心原理是什么. 了解一下最近新增的 omniparser 方式是如何工作的， 如何增强 MCP 协作的



----
  
他人提供了一份反馈与改进建议, 我会对每点进行针对性的提醒你来应用我的修改提示,
- 直接应用
1. MCP 可增强的方面
错误处理与反馈:
当前错误信息较为模糊（如 "Invalid action or missing parameters"），建议提供更具体的错误原因和修复建议。
例如，phone_app_control 工具应明确提示缺少哪些参数或动作无效方便快速定位问题。
且当前调用失败可能由于对方的提示模糊, 导致我的使用方式不当, 对方需要明确定义好


- 广告一般是阻挡我们进行下一步操作的内容, 一般情况都需要关闭, 请你设计一个函数根据以下提示精准关闭广告, 以下是核心依据, 你需要做两步, 1.prompt 增加判断广告的提示, 引导外部 LLM 关闭广告后继续操作, 2.写一个循环检测服务, 每一次触发 dump_ui 后 auto_check 是否存在广告, 存在自动关闭, 之后重新dump 给 到用户, 这个操作最多循环 3次, 帮助用户自动关闭广告, 3 次的原因是很少有多个连续广告 2.避免用户等太久, 可以等 外部 LLM 再次调用时再次检测关闭, 谨记: 这个函数初期要谨慎判断, 仅判断下列核心依据, 我考虑后期一点点补充, 这样减少无误操作情况. 总结: 1.prompte engineering 增加引导 prompt 2.增加函数自动关闭广告
2. 判断当前是广告的核心依据
控件特征:
存在 mIvAd（广告图片控件）和 mIvClose（关闭按钮）的 resource_id，这是广告的典型设计。
控件数量较少（仅 8 个），且无文本内容（text_elements: 0），符合广告页面的简洁特性。
布局特征:
关闭按钮位于屏幕右上角（bounds 显示坐标 [658,2166][781,2289]），这是广告关闭按钮的常见位置。

- 检查是否有外部 LLM 所述的增强内容, 我认为需要有一个示例操作给到 外部 LLM 简单的提示这个工具如何使用, 调用链. 
3. 如何更好地完成任务
分步引导:
提供更清晰的步骤建议，例如：
关闭广告（点击 mIvClose）。
导航到节目列表页。
搜索目标节目。
增强工具能力:
支持自动检测广告并关闭。
提供更强大的文本搜索功能（如支持模糊匹配或正则表达式）。
交互优化:
允许用户手动干预（如标注目标元素或提供额外输入）。


修正你所述 ❌ 不足之处, :
1. 提示词过于冗长: 系统提示词过度复杂
2. 中英混合: 部分提示词中英文混杂，不够简洁
3. 缺乏简化: 没有遵循KISS原则


detect_ad_elements 放到 prompt_engineering 干什么 我需要的是 prompt  + 函数方式, 而不是这种, 请你仔细思考如何让用户正确关闭广告, 我们目前也不会提供给函数关闭广告只是让他自己判断是否广告后关闭,
  经过修改后的版本如果我们无法自动关闭一定是当前代码无法做到, 那只能由其自己判断后自己点击 之后我们再确认是什么原因导致未关闭(比如名字有迷惑性) 因此 prompt 只是 prompt, 函数也应该再代码正确位置,
  你搞混了一些事情





1. 用户调用 dump_ui()
2. 系统自动检测 是否存在广告 1.元素数量若较少则广告存在的情况升高 2.存在 ad 关键词 3.同时存在 close 4.  AD 和 close 原点之间距离, 若过近则代表是也会存在 阈值默认 90% 确信才点击
3. 如果检测到广告 → 自动尝试关闭 -> 自动重新 dump_ui -> 尝试检测广告（最多3次循环)
4. 3次后仍有广告, 阈值 70%  → 返回最终UI状态给用户，标注可能存在未关闭的广告
5. 外部LLM 看到UI状态 + 广告提示 → 根据prompt指导手动判断和关闭
6. 如果手动也失败 → 我们可以收集反馈，了解是什么原因导致检测或关闭失败

  设计原则:

  - 自动处理: dump_ui()中自动检测+关闭（3次循环）
  - 手动补充: 自动失败后，prompt引导外部LLM手动处理
  - 反馈机制: 收集失败案例，优化检测逻辑

  关键分工:

  - 函数: 检测广告、自动关闭、返回状态
  - Prompt: 引导外部LLM识别广告特征、手动关闭广告

  这个流程设计是否符合你的预期？请指出需要调整的地方，我会按照你的指导重新修改代码。
--------------

常用操作 prompt, 我经常使用这个 MCP 来操作影视类 apk, 比如像腾讯手机端, 请你生成一些引导帮助 外部 LLM 能接收到指令后如何操作, 比如 我输入 打开包名 com.mobile.brasiltvmobile apk 播放节目 "西语手机端720资源02"
这时用户如果进去 APK 肯定是找不到的, 因为一般有升级提示或者广告, 因此需要 外部 LLM 知道应该关闭这些内容, 专注用户的任务
之后应该去首页 dump ui 找到元素, 这时可能找不到元素, 因为这个节目不一定再首页能直接找到
这时外部 LLM 应该尝试找到可下滑的区域, 下滑一定距离, 再重新 dump_ui, 重新检阅, 如果还没看到应该判断元素是否变化来确认下滑区域操作区域是否正确, 如果不正确就重新判断滑动
如果还是找不到可尝试找到搜索相关btn , 之后点击搜索输入内容 找到这个节目并点击播放. 
这是一个示例, 请你思考一下, 影视类 apk 较难的操作, 以及思考逻辑, 你应该教会 外部 LLM 如何思考, prompt engineer 是干这个的. 但请注意, 我的描述很多, 你应当英语简化后进行提示.
